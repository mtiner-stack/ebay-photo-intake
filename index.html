<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>eBay Photo Intake</title>

<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    margin: 16px;
    background: #f7f7f7;
  }
  h2 { margin-bottom: 12px; }

  .card {
    background: #fff;
    padding: 16px;
    border-radius: 14px;
    box-shadow: 0 4px 10px rgba(0,0,0,.06);
  }

  label {
    font-weight: 600;
    margin-top: 12px;
    display: block;
  }

  input, textarea {
    width: 100%;
    font-size: 16px;
    padding: 10px;
    margin-top: 6px;
    border-radius: 10px;
    border: 1px solid #ccc;
  }

  input[type="file"] {
    border: none;
  }

  button {
    width: 100%;
    margin-top: 14px;
    padding: 14px;
    font-size: 18px;
    border-radius: 12px;
    border: none;
    background: #007aff;
    color: white;
    font-weight: 600;
  }

  button.secondary {
    background: #aaa;
    margin-top: 8px;
  }

  .thumbs {
    display: flex;
    flex-wrap: wrap;
    margin-top: 10px;
  }

  .thumbs img {
    width: 70px;
    height: 70px;
    object-fit: cover;
    margin: 6px;
    border-radius: 10px;
    border: 1px solid #ddd;
  }

  .status {
    margin-top: 10px;
    font-weight: 600;
  }
</style>
</head>

<body>

<h2>eBay Photo Intake</h2>

<div class="card">
  <label>SKU</label>
  <input id="sku" placeholder="Enter SKU number" />

  <label>Notes</label>
  <textarea id="notes" rows="3" placeholder="Optional notes for VA"></textarea>

  <label>Photos (up to 10)</label>
  <input
    id="photos"
    type="file"
    accept="image/*"
    capture="environment"
    multiple
  />

  <div class="thumbs" id="thumbs"></div>

  <button onclick="submitForm()">Submit</button>
  <button class="secondary" onclick="resetForm()">Reset</button>

  <div class="status" id="status"></div>
</div>

<script>
  // ===== CONFIG =====
  const ENDPOINT_URL = "https://script.google.com/macros/s/AKfycbyr6idquQq6Ct-eLpokTkHylwva_DzIXtaxusx6kQSIXwmwicHgpHmh0oScm0kr4529/exec";
  const SHARED_SECRET = "road-ebay-photo-intake-2026-VERY-LONG";
  // ==================

  let files = [];

  document.getElementById("photos").addEventListener("change", e => {
    const selected = Array.from(e.target.files);
    files = files.concat(selected).slice(0, 10);
    renderThumbs();
    e.target.value = "";
  });

  function renderThumbs() {
    const thumbs = document.getElementById("thumbs");
    thumbs.innerHTML = "";
    files.forEach((file, i) => {
      const img = document.createElement("img");
      img.src = URL.createObjectURL(file);
      img.title = "Tap to remove";
      img.onclick = () => {
        files.splice(i, 1);
        renderThumbs();
      };
      thumbs.appendChild(img);
    });
  }

  async function submitForm() {
    const sku = document.getElementById("sku").value.trim();
    const notes = document.getElementById("notes").value.trim();
    const status = document.getElementById("status");

    if (!sku) return status.textContent = "SKU is required.";
    if (files.length === 0) return status.textContent = "Add at least one photo.";

    status.textContent = "Uploading…";

    try {
      const photos = [];
      for (const f of files) {
        const base64 = await toBase64(f);
        photos.push({
          filename: f.name || `${sku}.jpg`,
          mimeType: f.type || "image/jpeg",
          base64
        });
      }

      const payload = {
        secret: SHARED_SECRET,
        sku,
        notes,
        photos
      };

      const res = await fetch(ENDPOINT_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      const json = await res.json();
      if (!json.ok) throw new Error(json.error || "Upload failed");

      status.textContent = `✅ Uploaded ${json.count} photo(s)`;
      resetForm();

    } catch (err) {
      status.textContent = "❌ " + err.message;
    }
  }

  function resetForm() {
    document.getElementById("sku").value = "";
    document.getElementById("notes").value = "";
    files = [];
    renderThumbs();
  }

  function toBase64(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onerror = reject;
      reader.onload = () => resolve(reader.result.split(",")[1]);
      reader.readAsDataURL(file);
    });
  }
</script>

</body>
</html>
